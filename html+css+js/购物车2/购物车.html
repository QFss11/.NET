<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>购物车功能</title>
    <script src="./js/jquery-3.3.1.min.js"></script>
    <style>
        *{
            margin:0;
            padding:0;
        }
        img{
            width:50px;
            height: 50px;
            /* 图文混排时，让文字参考图片垂直的位置排版 */
            vertical-align: middle;
        }
        .num{
            width:30px;
        }
    </style>
</head>
<body>
    
    <table border="1">
        <tr>
            <th>商品名称</th>
            <th>状态</th>
            <th>商品数量</th>
            <th>单价</th>
            <th>小计</th>
            <th>操作</th>
        </tr>
        <tr class="shop-item">
            <td>
                <img src="./img/good1.jpg" alt="">
                精品大床房精品酒店
            </td>
            <td>可购买</td>
            <td>
                <input type="button" value="-" class="decount">
                <input type="text" name="" disabled value="1" class="num">
                <input type="button" value="+" class="add">
            </td>
            <td>59.9</td>
            <td></td>
            <td>
                <a href="#" class="del">删除商品</a>
            </td>
        </tr>
        <tr class="shop-item">
            <td>
                <img src="./img/good1.jpg" alt="">
                精品大床房精品酒店
            </td>
            <td>可购买</td>
            <td>
                <input type="button" value="-" class="decount">
                <input type="text" name="" disabled value="1" class="num">
                <input type="button" value="+" class="add">
            </td>
            <td>299.9</td>
            <td></td>
            <td>
                <a href="#" class="del">删除商品</a>
            </td>
        </tr>
        <tr class="shop-item">
            <td>
                <img src="./img/good1.jpg" alt="">
                精品大床房精品酒店
            </td>
            <td>可购买</td>
            <td>
                <input type="button" value="-" class="decount">
                <input type="text" name="" disabled value="1" class="num">
                <input type="button" value="+" class="add">
            </td>
            <td>199.9</td>
            <td></td>
            <td>
                <a href="#" class="del">删除商品</a>
            </td>
        </tr>
        <tr class="shop-item">
            <td>
                <img src="./img/good1.jpg" alt="">
                精品大床房精品酒店
            </td>
            <td>可购买</td>
            <td>
                <input type="button" value="-" class="decount">
                <input type="text" name="" disabled value="1" class="num">
                <input type="button" value="+" class="add">
            </td>
            <td>199.9</td>
            <td></td>
            <td>
                <a href="#" class="del">删除商品</a>
            </td>
        </tr>
        <tr class="shop-item">
            <td>
                <img src="./img/good1.jpg" alt="">
                精品大床房精品酒店
            </td>
            <td>可购买</td>
            <td>
                <input type="button" value="-" class="decount">
                <input type="text" name="" disabled value="1" class="num">
                <input type="button" value="+" class="add">
            </td>
            <td>199.9</td>
            <td></td>
            <td>
                <a href="#" class="del">删除商品</a>
            </td>
        </tr>
        <!-- 求商品的总件数 和 商品的总价 -->
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>商品<span id="nums">0</span>件</td>
            <td>应付金额<span id="sums">0</span>元</td>
            <td></td>
        </tr>
    </table>
    <script>
        // 删除商品
        $(".del").click(function(){
            // 弹出提示 确定 和 取消
            if(confirm("是否删除该商品？"))
            {
                $(this).parent().parent().remove();
                countSum();
            }
        });
        //初始化时调用
        countSum();
        function countSum()
        {
            //商品总件数
            var nums = 0;
            // 商品总金额
            var sums = 0;
            // 初始化时，求解商品的价格*数量，显示到小计中
            $(".shop-item").each(function(index){
                //对应每个商品的索引为index 这个【索引从0开始】
                //1、获取商品数量 eq() 等于第几个索引的标签
                var shopNum = $(".num").eq(index).val();
                // 2、获取商品的价格
                var price = $(".num").eq(index).parent().next("td").text();
                //3、求商品的小计
                var sum = shopNum * price;
                $(".num").eq(index).parent().next("td").next("td").text(sum.toFixed(2));
                //直接求商品的和，价格
                nums += parseInt(shopNum);//0111 它当作字符串拼接，就不是数字相加
                sums += sum;
            });
            $("#nums").text(nums);
            $("#sums").text(sums.toFixed(2));
        }

        // 通过类名获取，可以获取多个标签的意思
        $(".add").click(function(){
            // 1、获取它当前这个商品的数量
            var shopNum = $(this).prev("input").val();
            // prev() 获取相邻的前一个标签 next() 获取相邻的下一个标签
            //2、点击一次，商品数量累加 1
            shopNum++;
            // 3、修改框的商品数量
            $(this).prev("input").val(shopNum);

            countShopSum($(this),shopNum);

        });

        // 做商品减
        $(".decount").click(function(){
            // 1、获取它当前这个商品的数量
            var shopNum = $(this).next("input").val();
            // prev() 获取相邻的前一个标签 next() 获取相邻的下一个标签
            //2、点击一次，商品数量累加 1
            if(shopNum > 1)
            {
                shopNum--;
            }
            // 3、把商品数量放到对应框中
            $(this).next("input").val(shopNum);

            countShopSum($(this),shopNum);

        });

        // 优化相同的代码：
        function countShopSum(obj,shopNum)
        {
            // 4、获取商品的单价
            var price = obj.parent().next("td").text();
            //5、求和
            var sum = shopNum * price;
            //6、赋值到指定的框中
            obj.parent().next("td").next("td").text(sum.toFixed(2));
            countSum();
        }
    </script>
</body>
</html>